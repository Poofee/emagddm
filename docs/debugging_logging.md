# 调试与日志规范

## 日志规范（基于spdlog）
使用include\tool\logger_factory.hpp下的宏调用。

### 日志分级
严格按以下分级输出日志，禁止随意使用高等级日志，禁止遗漏关键操作日志。

- **DEBUG**：开发调试用，输出关键参数、操作步骤（如子域ID、迭代次数、残差），仅在调试模式下启用
- **INFO**：正常运行信息，输出求解进度、模块初始化结果、交付物输出路径（如"子域初始化完成，共4个子域"）
- **WARN**：警告信息，输出非致命错误（如配置参数不合理、网格质量较差），不影响程序运行
- **ERROR**：错误信息，输出致命错误（如库调用失败、内存分配失败、子域求解失败），程序无法继续运行或求解结果无效

### 日志输出
- 日志同时输出到控制台和 output/log/ 目录下的日志文件
- 日志文件按日期命名（如2026-XX-XX.log），编码为UTF-8

### 日志格式
日志需包含"时间、日志级别、模块名称、日志内容"

**示例**：
```
[2026-XX-XX 10:30:00.123] [INFO] [fetidp_global] FETI-DP全局求解开始，子域数：4，粗节点数：50
[2026-XX-XX 10:30:01.456] [DEBUG] [fetidp_dual] 对偶迭代第1次，残差：1.234e-2
[2026-XX-XX 10:30:10.789] [INFO] [fetidp_global] FETI-DP求解收敛，迭代次数：32，总耗时：10.66s
[2026-XX-XX 10:30:11.000] [ERROR] [fe_em_mesh] 网格读取失败：文件mesh/motor2d_error.msh不存在
```

## 调试规范

### 调试模式
- 通过CMake配置DEBUG模式（启用-DDEBUG=ON），启用DEBUG级日志
- 发布模式（RELEASE）仅启用INFO/WARN/ERROR级日志

### 问题排查
- 程序运行失败时，优先查看日志文件，定位错误模块、错误原因
- 禁止盲目修改代码

### 并行调试
- MPI并行开发时，每个进程的日志需添加进程ID标识
- 便于排查跨进程通信错误

### 内存调试
- Linux下使用valgrind检测内存泄漏
- Windows下使用VS Code Debug检测内存问题
- 确保无明显内存泄漏