# Maxwell 电磁仿真数据核心需求及特性适配

聚焦Maxwell电磁仿真项目数据的**专属属性**和**工程化数据管理的核心需求**，除了基础的读取/保存，还需要围绕**数据的合法性、关联性、兼容性、高效性、可追溯性**，以及**电磁仿真数据的特有特征**补充设计特性，所有特性均服务于「纯数据管理」核心（无求解、无前处理），贴合工程化实际使用场景。

以下是分维度的核心特性，均能无缝融入你现有的开发计划，且每个特性都有明确的落地价值：

## 一、**数据校验与合法性保障**

这是基础读取/保存的核心延伸，避免读取无效数据、保存损坏数据，是数据可靠性的前提，也是电磁仿真数据的硬性要求。

1. **格式合法性校验**：读取时校验文件头、节点结构、数据编码是否符合Maxwell规范/自研格式规范，拒绝损坏、篡改的文件；保存时校验数据块完整性，避免写入半截、缺失的文件。

2. **业务规则校验**：针对电磁仿真数据的专属规则做校验（核心），比如：

    - 几何数据：顶点/边/面/体的拓扑闭合性、布尔运算结果的有效性、坐标值的合理性（无异常超大/负数）；

    - 材料数据：磁导率/电导率等参数的物理合理性（无负数、无超范围值）、BH曲线数据的单调性（避免无效曲线）；

    - 关联数据：几何EntityID与材料/边界/激励ID的映射无悬空（比如绑定了不存在的几何ID）、边界无冲突（同一几何面同时绑定多个互斥边界）。

3. **数据完整性校验**：读取/保存时校验核心数据块无缺失（比如读取Maxwell文件时，几何数据存在但材料分配数据缺失，需主动抛出异常并提示）；支持**数据校验报告**输出，明确指出无效数据的位置和原因。

## 二、**数据关联与拓扑映射**

Maxwell项目数据并非孤立模块，而是**强关联的拓扑整体**（几何是基础，材料/边界/激励均绑定几何实体），这是电磁仿真数据的核心特征，也是数据管理的关键。

1. **全局唯一ID映射体系**：完善现有ID生成工具，实现**全数据维度的ID唯一绑定**，包括：几何实体（顶点/边/面/体）ID、材料ID、边界ID、激励ID、项目ID，且ID需**兼容Maxwell原生ID规则**（读取Maxwell文件时直接复用原生ID，避免映射错乱）。

2. **强关联关系存储**：明确并固化「主数据-从数据」的关联映射表，以**键值对+索引**的形式存储，比如：

    - `EntityID(几何ID) → MaterialID(材料ID)`：记录每个几何实体绑定的材料；

    - `EntityID → BoundaryIDList(边界ID列表)`：记录每个几何实体绑定的所有边界；

    - `EntityID → ExcitationID(激励ID)`：记录每个激励绑定的几何区域；

    映射表需和核心数据一起读取/保存，确保数据联动性（比如读取几何数据时，同步加载其绑定的所有材料/边界数据）。

3. **关联关系校验与保护**：删除/修改某一数据时，自动校验关联关系（比如删除某几何实体时，提示其绑定了哪些材料/边界/激励，避免误删导致数据悬空）；支持**关联关系可视化索引**（可选，工程化友好），快速查询某一ID的所有关联数据。

## 三、**多格式兼容与无缝转换**

除了基础的「读取Maxwell格式+保存自研格式」，还需要考虑**格式适配的灵活性和兼容性**，满足工程化中「多工具协同、数据复用」的需求。

1. **格式双向转换**：在现有“Maxwell格式→自研MaxwellDataModel”的基础上，完善**自研格式→Maxwell兼容格式**的双向转换，且转换过程中**无核心数据丢失**（比如自研.emf包可导出为Maxwell能直接打开的.xml/.aedt，保留所有几何/材料/边界/激励参数）。

2. **通用中间格式支持**：接入电磁/几何仿真领域的**通用中间格式**，作为数据交换的桥梁，比如：

    - 几何数据：STL/STEP/SAT/IGES（Maxwell原生支持，读取时直接解析，保存时支持导出）；

    - 材料数据：.amat/.txt（Maxwell材料库格式，支持批量导入/导出）；

    - 通用数据：JSON/YAML/XML（明文格式，方便用户手动编辑、跨工具复用）；

3. **格式适配层解耦**：将格式解析/转换逻辑封装为**独立的适配层**，与核心数据模型（MaxwellDataModel）解耦，后续新增支持的格式（比如其他仿真软件的项目格式）时，无需修改核心数据模型，仅需新增适配层插件即可。

## 四、**数据轻量化与高效读写**

针对Maxwell项目数据**大体积、高维度**的特点（比如3D项目的几何/网格数据可达GB级），优化读写效率和内存占用，避免大文件读写卡顿、内存溢出。

1. **按需加载与分片读写**：支持**按数据模块/数据范围的按需加载**，比如仅读取项目的材料库数据，无需加载整个几何/网格数据；大体积数据（如网格、几何拓扑）采用**分片存储/分片读写**，按固定大小分块，避免一次性加载整个文件到内存。

2. **数据压缩与高效存储**：保存自研格式（.emf）时，对**二进制大体积数据**（如几何顶点坐标、网格节点数据）做轻量级无损压缩（如LZ4/ZIP），减小文件体积；对**明文数据**（如项目元数据、参数配置）不压缩，保持可编辑性。

3. **内存缓存与复用**：开发**多级内存缓存机制**，频繁读取的核心数据（如Maxwell标准材料库）缓存到内存，避免重复磁盘IO；读取大文件时，采用**内存池管理**，减少内存碎片，避免内存溢出。

4. **批量读写支持**：完善现有批量处理接口，支持**多项目批量读取/保存/格式转换**，且批量操作时采用**异步IO**，提升处理效率（比如批量读取100个Maxwell项目文件，无需串行等待，适合工程化多算例场景）。

## 五、**数据版本与操作溯源**

工程化中，项目数据会经过多次修改、读取、保存，需要**记录数据变更轨迹**，避免误操作导致数据损坏，且支持追溯和回滚。

1. **操作日志全记录**：记录所有数据操作的**完整日志**，包括：操作人、操作时间、操作类型（读取/保存/修改/删除/格式转换）、操作对象（如某几何ID/材料ID）、操作前后的参数变化，日志需和项目数据一起保存，支持日志查询和导出。

2. **版本管理与自动备份**：在现有自动备份的基础上，完善**版本化管理**：

    - 手动版本：支持用户手动创建版本（如“V1.0-初始版本”“V1.1-修改材料参数”），并添加版本备注；

    - 自动版本：保存数据时自动创建增量版本（仅保存修改的数块，而非全量数据），保留最近N个版本（可配置）；

    - 版本回滚：支持一键回滚到某一历史版本，且回滚后的数据完整性不受影响。

3. **数据变更对比**：支持**任意两个版本之间的核心数据对比**，输出变更报告（比如对比V1.0和V1.1，明确指出哪些材料参数被修改、哪些边界被添加），方便工程化协作中的数据审核。

## 六、**电磁仿真专属数据特性适配**

这是区别于通用数据管理的核心，必须针对**Maxwell电磁仿真数据的特有属性**做定制化设计，确保数据读取/保存的专业性和准确性。

1. **非线性/各向异性数据的精准存储**：针对材料的BH曲线、磁化曲线、温度相关参数，采用**高精度序列化**（如双精度浮点数）存储，避免插值/保存时的精度损失；支持**曲线数据的分段存储**，方便后续快速读取和插值。

2. **绕组/激励的结构化存储**：针对Maxwell的线圈绕组（多匝/分层/串并联）、时变激励（正弦/方波/自定义波形），采用**结构化数据模型**存储，保留所有细节参数（如绕组匝数、线径、并联支路数、激励波形的采样点/频率/幅值），而非简单的数值存储。

3. **多维度/多场型数据的适配**：针对Maxwell的2D/3D/2D轴对称维度，以及静磁/瞬态/静电等场型，在核心数据模型中添加**维度/场型标识**，读取时自动识别并适配数据结构（比如2D几何仅存储面/边，3D几何存储体/面/边），保存时按维度/场型分类存储，避免数据混淆。

4. **附属资源的关联管理**：Maxwell项目数据包含大量**附属资源文件**（如BH曲线的.dat文件、自定义激励波形的.txt文件、材料库的.amat文件），需要将这些资源文件与核心数据**关联管理**：

    - 读取时：自动识别并加载附属资源文件，与核心数据绑定；

    - 保存时：将附属资源文件统一存入项目包的`resources/`目录，采用**相对路径**关联，确保项目包的**可移植性**（复制到任意路径，附属资源均可正常加载）。

## 七、**数据安全与可靠性**

针对工程化中**数据保密性、防篡改**的需求，补充基础的数据安全特性，避免核心项目数据泄露或被篡改。

1. **数据防篡改**：保存自研格式时，为核心数据块添加**校验和（MD5/SHA256）**，读取时自动验证校验和，若数据被篡改，直接抛出异常并拒绝加载。

2. **基础加密支持**：针对敏感项目数据，支持**轻量级加密保存**（如AES-128），加密仅针对核心二进制数据块，明文元数据（如项目名称）不加密，兼顾安全性和易用性；支持密码验证，只有输入正确密码才能读取加密的项目文件。

3. **数据损坏恢复**：保存时为项目文件添加**损坏恢复索引**，若文件因磁盘故障、断电等原因损坏，读取时可根据恢复索引恢复未损坏的核心数据块，并提示损坏的部分，避免数据完全丢失。

## 八、**易用性与工程化工具支持**

围绕**用户使用体验**，补充轻量化的工程化工具，无需复杂操作，即可实现数据的快速管理，贴合工程人员的使用习惯。

1. **数据预览功能**：支持**无需全量加载的快速预览**，比如读取Maxwell文件时，无需加载整个几何/网格数据，即可快速查看项目元数据（仿真维度/场型、材料数量、边界数量、激励数量），方便用户快速筛选所需项目。

2. **批量数据提取/导出**：支持**按条件批量提取/导出核心数据**，比如：

    - 批量提取所有项目的材料库数据，导出为.amat格式，实现材料库复用；

    - 批量导出所有项目的边界/激励参数，导出为Excel/CSV，方便数据统计和分析；

3. **错误提示与问题定位**：所有数据读取/保存/校验的异常，均输出**清晰、可落地的错误提示**，而非专业的程序异常，比如：“读取失败：几何ID=100的面绑定了不存在的边界ID=200（悬空关联）”，方便用户快速定位并解决问题。

## 九、**可扩展性与模块化设计**

为后续功能迭代（比如新增支持其他仿真软件的项目格式、新增数据筛选/分析功能）预留扩展空间，避免后期重构核心代码。

1. **核心数据模型可扩展**：核心数据模型（MaxwellDataModel）采用**模块化、可继承**的设计，新增数据类型（比如新增高频仿真的端口数据）时，仅需新增派生类，无需修改原有核心代码。

2. **插件化扩展接口**：将格式解析、数据校验、数据导出等功能封装为**插件化接口**，后续新增功能（如新增某一格式的解析、新增某一数据校验规则）时，仅需开发对应的插件，动态接入即可。

3. **配置化管理**：将所有可配置的参数（如备份版本数、分片大小、压缩方式、支持的格式）集中在**配置文件**（如config.json）中，用户无需修改代码，仅需编辑配置文件即可调整功能，适配不同的使用场景。

### 核心特性总结（落地优先级排序）

以上特性均围绕「纯数据管理」核心，无求解/前处理相关内容，且可根据开发周期**分优先级落地**，核心必做→次优先→可选优化：

1. **核心必做**：数据校验与合法性、数据关联与拓扑映射、多格式双向转换、轻量化分片读写（解决数据可靠性和基础工程化需求）；

2. **次优先**：操作日志与版本备份、附属资源关联管理、电磁专属数据精准存储（解决工程化协作和数据溯源需求）；

3. **可选优化**：数据加密、批量数据提取、插件化扩展、数据预览（提升易用性和扩展性，根据开发周期灵活调整）。

所有特性均可无缝融入你现有的开发计划，比如数据校验可整合到ProjectManager的读取/保存流程中，数据关联映射可完善现有ID生成和映射表设计，轻量化读写可优化现有.emf包的分片存储逻辑。
> （注：文档部分内容可能由 AI 生成）